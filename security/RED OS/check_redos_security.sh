#!/bin/bash

set -e

OS_INFO=$(grep -E '^NAME|^VERSION_ID' /etc/os-release)
echo "üì¶ –û–°: $OS_INFO"
echo

# –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –û–° ‚Äî –†–ï–î –û–° 7.x
if ! grep -q 'RED OS' <<< "$OS_INFO" || ! grep -q '7' <<< "$OS_INFO"; then
    echo "‚ùå –°–∫—Ä–∏–ø—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –Ω–∞ –†–ï–î –û–° 7.x"
    exit 1
fi

# –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü (–≤—Ä—É—á–Ω—É—é –≤—ã–¥–µ–ª–µ–Ω–æ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞)
TABLES=(
    "1. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ–º–µ–Ω–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏"
    "2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ –∫–ª—é—á—É"
    "3. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏"
    "4. –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤"
    "5. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π (–∞—É–¥–∏—Ç–∞)"
    "6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤ –∑–∞—â–∏—Ç—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏"
)

echo "üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:"
for i in "${!TABLES[@]}"; do
    printf "%d) %s\n" "$((i+1))" "${TABLES[$i]}"
done

echo
read -p "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏: " selection

if ! [[ "$selection" =~ ^[1-6]$ ]]; then
    echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä. –î–æ–ø—É—Å—Ç–∏–º—ã —Ç–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏—è 1-6."
    exit 1
fi

echo
echo "üîç –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: ${TABLES[$((selection-1))]}"

# –ó–¥–µ—Å—å –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
case "$selection" in
    1)
        echo "‚û° –ü—Ä–æ–≤–µ—Ä–∫–∞: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ–º–µ–Ω–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏"
        # –ü—Ä–∏–º–µ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏:
        grep -q "cache_credentials = False" /etc/sssd/sssd.conf && echo "‚úÖ cache_credentials –æ—Ç–∫–ª—é—á–µ–Ω" || echo "‚ö†Ô∏è –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–∫–ª—é—á–∏—Ç—å cache_credentials"
        grep -q "core_dumpable = False" /etc/sssd/sssd.conf && echo "‚úÖ core_dumpable —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω" || echo "‚ö†Ô∏è –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å core_dumpable = False"
        grep -q "krb5_store_password_if_offline = False" /etc/sssd/sssd.conf && echo "‚úÖ krb5_store_password_if_offline —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω" || echo "‚ö†Ô∏è –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å krb5_store_password_if_offline = False"
        ;;
    2)
        echo "‚û° –ü—Ä–æ–≤–µ—Ä–∫–∞: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ –∫–ª—é—á—É"
        grep -q "^PubkeyAuthentication yes" /etc/ssh/sshd_config && echo "‚úÖ PubkeyAuthentication –≤–∫–ª—é—á–µ–Ω" || echo "‚ö†Ô∏è –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–∫–ª—é—á–∏—Ç—å PubkeyAuthentication"
        ;;
    3)
        echo "‚û° –ü—Ä–æ–≤–µ—Ä–∫–∞: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏"
        grep -q "^PASS_MAX_DAYS[[:space:]]\+90" /etc/login.defs && echo "‚úÖ PASS_MAX_DAYS = 90" || echo "‚ö†Ô∏è PASS_MAX_DAYS –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        ;;
    4)
        echo "‚û° –ü—Ä–æ–≤–µ—Ä–∫–∞: –û—Ç–∫–ª—é—á–µ–Ω–∏–µ cramfs, udf –∏ –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º"
        modprobe -n -v cramfs | grep -q 'install /bin/true' && echo "‚úÖ cramfs –æ—Ç–∫–ª—é—á–µ–Ω" || echo "‚ö†Ô∏è cramfs –Ω–µ –æ—Ç–∫–ª—é—á–µ–Ω"
        ;;
    5)
        echo "‚û° –ü—Ä–æ–≤–µ—Ä–∫–∞: –ù–∞–ª–∏—á–∏–µ –∏ —Å—Ç–∞—Ç—É—Å auditd"
        systemctl is-enabled auditd &>/dev/null && echo "‚úÖ auditd –≤–∫–ª—é—á–µ–Ω" || echo "‚ö†Ô∏è auditd –Ω–µ –≤–∫–ª—é—á–µ–Ω"
        ;;
    6)
        echo "‚û° –ü—Ä–æ–≤–µ—Ä–∫–∞: –ó–∞—â–∏—Ç–∞ —è–¥—Ä–∞ –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã"
        grep -q "kernel.kptr_restrict = 2" /etc/sysctl.conf && echo "‚úÖ kernel.kptr_restrict = 2 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω" || echo "‚ö†Ô∏è kernel.kptr_restrict –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç"
        ;;
esac

echo
echo "üèÅ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –∏–∑ –∫–æ–ª–æ–Ω–∫–∏ '–î–µ—Ç–∞–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏', –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –Ω–µ ‚úÖ."
